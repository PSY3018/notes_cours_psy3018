
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cartes statistiques &#8212; Méthodes en neurosciences cognitives</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Reproductibilité et controverses" href="reproductibilite.html" />
    <link rel="prev" title="Imagerie optique" href="imagerie_optique.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Méthodes en neurosciences cognitives</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Introduction
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="cartes_cerebrales.html">
   Cartes cérébrales
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="irm.html">
   Imagerie par résonance magnétique
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="morphometrie.html">
   Analyses morphométriques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="irm_fonctionnelle.html">
   IRM fonctionnelle
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="connectivite.html">
   Connectivité fonctionnelle
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="irm_diffusion.html">
   IRM de diffusion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tep.html">
   Tomographie par émission de positrons
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imagerie_optique.html">
   Imagerie optique
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Cartes statistiques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reproductibilite.html">
   Reproductibilité et controverses
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="_sources/cartes_statistiques.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/cartes_statistiques.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/psy3018/notes_cours_psy3018/main?urlpath=tree/methodes_neurocog/cartes_statistiques.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#objectifs-du-cours">
   Objectifs du cours
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regression-lineaire">
   Régression linéaire
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#variables">
     Variables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modele-lineaire">
     Modèle linéaire
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analyse-massivement-univariee">
     Analyse massivement univariée
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modele-lineaire-general">
   Modèle linéaire général
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Variables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regression-multiple">
     Régression multiple
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Cartes statistiques
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tests-statistiques">
   Tests statistiques
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tests-t-et-valeur-p">
     Tests t et valeur p
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hypothese-nulle">
     Hypothèse nulle
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparaisons-multiples">
     Comparaisons multiples
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercices">
   Exercices
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="cartes-statistiques">
<span id="cartes-statistiques-chapitre"></span><h1>Cartes statistiques<a class="headerlink" href="#cartes-statistiques" title="Permalink to this headline">¶</a></h1>
<table>
  <tr>
    <td align="center">
      <a href="https://github.com/elisabethloranger">
        <img src="https://avatars.githubusercontent.com/u/90270981?v=4?s=100" width="100px;" alt=""/>
        <br /><sub><b>Élisabeth Loranger</b></sub>
      </a>
      <br />
        <a title="Contenu">🤔</a>
    </td>
    <td align="center">
      <a href="https://github.com/pbellec">
        <img src="https://avatars.githubusercontent.com/u/1670887?v=4?s=100" width="100px;" alt=""/>
        <br /><sub><b>Pierre bellec</b></sub>
      </a>
      <br />
        <a title="Contenu">🤔</a>
    </td>
    <td align="center">
      <a href="https://github.com/eddyfortier">
        <img src="https://avatars.githubusercontent.com/u/72314243?v=4?s=100" width="100px;" alt=""/>
        <br /><sub><b>Eddy Fortier</b></sub>
      </a>
      <br />
        <a title="Révision du texte">👀</a>
    </td>
  </tr>
</table>
<div class="section" id="objectifs-du-cours">
<h2>Objectifs du cours<a class="headerlink" href="#objectifs-du-cours" title="Permalink to this headline">¶</a></h2>
<p>Dans ce chapitre, il sera question de l’utilisation du modèle de régression pour générer des cartes statistiques cérébrales de groupe. Les statistiques de groupe permettent de combiner les mesures du cerveau de plusieurs individus et ainsi de contraster des groupes (ex. groupe de personnes jeunes et groupe de personnes âgées) ou bien de tester l’association avec une variable continue (ex. l’âge).</p>
<p>Les objectifs spécifiques du cours portent sur les concepts suivants :</p>
<ul class="simple">
<li><p>la régression linéaire,</p></li>
<li><p>le modèle linéaire général,</p></li>
<li><p>tests statistiques.</p></li>
</ul>
</div>
<div class="section" id="regression-lineaire">
<h2>Régression linéaire<a class="headerlink" href="#regression-lineaire" title="Permalink to this headline">¶</a></h2>
<div class="section" id="variables">
<h3>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importer les librairies</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">nilearn.input_data</span> <span class="kn">import</span> <span class="n">NiftiMasker</span>
<span class="kn">from</span> <span class="nn">nilearn.image</span> <span class="kn">import</span> <span class="n">get_data</span>

<span class="c1"># Charger les données</span>
<span class="n">n_subjects</span> <span class="o">=</span> <span class="mi">100</span>  
<span class="n">oasis_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_oasis_vbm</span><span class="p">(</span><span class="n">n_subjects</span><span class="o">=</span><span class="n">n_subjects</span><span class="p">)</span>
<span class="n">gray_matter_map_filenames</span> <span class="o">=</span> <span class="n">oasis_dataset</span><span class="o">.</span><span class="n">gray_matter_maps</span>
<span class="n">age</span> <span class="o">=</span> <span class="n">oasis_dataset</span><span class="o">.</span><span class="n">ext_vars</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">sex</span> <span class="o">=</span> <span class="n">oasis_dataset</span><span class="o">.</span><span class="n">ext_vars</span><span class="p">[</span><span class="s1">&#39;mf&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;F&#39;</span>

<span class="c1"># Conversion des données en pandas dataframe</span>
<span class="c1"># Deux voxels intéressants ont été sélectionnés</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mf">29.</span><span class="p">,</span>  <span class="mf">10.</span><span class="p">,</span>   <span class="mf">4.</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">19.</span><span class="p">,</span>   <span class="mf">8.</span><span class="p">,</span> <span class="o">-</span><span class="mf">11.</span><span class="p">]])</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;olive&#39;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">input_data</span>
<span class="n">masker</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">NiftiSpheresMasker</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
<span class="n">gm</span> <span class="o">=</span> <span class="n">masker</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">gray_matter_map_filenames</span><span class="p">)</span>
<span class="n">subject_label</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;sub-</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_subjects</span><span class="p">)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;subject_label&quot;</span><span class="p">:</span> <span class="n">subject_label</span><span class="p">,</span>
    <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="n">age</span><span class="p">,</span>
    <span class="s2">&quot;sexe&quot;</span><span class="p">:</span> <span class="n">oasis_dataset</span><span class="o">.</span><span class="n">ext_vars</span><span class="p">[</span><span class="s1">&#39;mf&#39;</span><span class="p">],</span>
    <span class="s2">&quot;MG1&quot;</span><span class="p">:</span> <span class="n">gm</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;MG2&quot;</span><span class="p">:</span> <span class="n">gm</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">})</span>

<span class="n">df</span><span class="p">[</span><span class="s2">&quot;sexe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sexe&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="sa">b</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;M&#39;</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;femelle&#39;</span><span class="p">,</span> <span class="s1">&#39;male&#39;</span><span class="p">])</span>

<span class="c1"># On génère la Figure</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>        
    <span class="n">nx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor_divide</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">ny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_anat</span><span class="p">(</span>
        <span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="n">nx</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
        <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="n">nx</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="n">nx</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;darkgrid&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;MG1&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">binwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">binrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;MG2&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">binwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">binrange</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;vbm-distribution-fig&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="vbm-distribution-fig" style="width: 800px">
<div class="cell_output docutils container">
<img alt="_images/cartes_statistiques_1_1.png" src="_images/cartes_statistiques_1_1.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 93 </span><span class="caption-text">La position de deux voxels (illustrée à l’aide d’un cercle bleu (haut) et d’un cercle olive (bas)) est ici superposée sur des cartes de densité de matière grise pour différents sujets du jeu de données OASIS (<a class="reference external" href="https://dx.doi.org/10.1162%2Fjocn.2009.21407">Marcus et al., 2010</a>). À droite, un histograme représente la distribution de la densité de matière grise pour le voxel correspondant, à travers un échantillon de 100 sujets. Cette figure est adaptée d’un tutoriel de la librairie <a class="reference external" href="https://nilearn.github.io/auto_examples/05_glm_second_level/plot_oasis.html#sphx-glr-auto-examples-05-glm-second-level-plot-oasis-py">nilearn</a> (cliquer sur + pour voir le code). Cette figure est distribuée sous license <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#vbm-distribution-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Les concepts présentés dans ce chapitre s’appliquent à la plupart des modalités d’imagerie vues dans le cours de façon plus ou moins identique. Afin de rendre les choses un peu plus concrètes, nous allons ici nous intéresser à une analyse morphométrique de type VBM (IRM structurelle). Cette analyse utilise le jeu de données OASIS (<a class="reference external" href="https://dx.doi.org/10.1162%2Fjocn.2009.21407">Marcus et al., 2010</a>). Des cartes de densité de matière grise pour les données OASIS sont disponibles via la librairie <a class="reference external" href="https://nilearn.github.io/modules/generated/nilearn.datasets.fetch_oasis_vbm.html">nilearn</a>. Pour chaque voxel, on dispose d’une mesure locale de densité de matière grise qui varie entre 0 et 1. Comme toutes les images des 100 participants OASIS utilisés dans cet exemple ont été recalées dans un même espace stéréotaxique, chaque voxel est associé à une série de 100 mesures. Il s’agit de notre <strong>variable dépendante</strong>. On va par la suite chercher à expliquer les variations de cette mesure à travers les sujets à l’aide d’autres variables, appelées les <strong>prédicteurs</strong>. Pour notre exemple, nous allons démarrer avec l’âge des participants qui varie ici de 20 ans à 90 ans.</p>
</div>
<div class="section" id="modele-lineaire">
<h3>Modèle linéaire<a class="headerlink" href="#modele-lineaire" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># On réorganise le DataFrame pour utiliser seaborn</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;sexe&quot;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;MG1&quot;</span><span class="p">,</span> <span class="s2">&quot;MG2&quot;</span><span class="p">],</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;MG&quot;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;MG&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span>
           <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>

<span class="c1"># On colle la figure dans le jupyter book</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;regression-vbm-fig&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>           
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="regression-vbm-fig" style="width: 800px">
<div class="cell_output docutils container">
<img alt="_images/cartes_statistiques_3_0.png" src="_images/cartes_statistiques_3_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 94 </span><span class="caption-text">Exemple de régression linéaire où la variable dépendante est la densité de matière grise pour un voxel et le prédicteur est l’âge. Les valeurs de densité de matière grise proviennent de 100 sujets de la base de données OASIS (<a class="reference external" href="https://dx.doi.org/10.1162%2Fjocn.2009.21407">Marcus et al., 2010</a>). Les deux voxels utilisés ici sont les mêmes que ceux représentés dans la <a class="reference internal" href="#vbm-distribution-fig"><span class="std std-numref">Fig. 93</span></a> (voxel bleu à gauche, voxel olive à droite). La régression linéaire est réalisée à l’aide de la libraire <a class="reference external" href="https://seaborn.pydata.org">seaborn</a> (cliquer sur + pour voir le code). Cette figure est distribuée sous license <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#regression-vbm-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Le concept soutenant le modèle de régression est une équation, ou une sorte de loi, qui va tenter de prédire la variable dépendante (ici, la densité de matière grise) à partir de prédicteurs (par exemple, l’âge). Mais contrairement à une loi physique qui tente de représenter une dépendance exacte (jusqu’à un certain degré), la présente loi ne capture qu’une fraction de la variance de notre mesure. La loi va donc incorporer un certain bruit représentant toutes les sources de variabilité que l’on ne peut pas capturer avec notre relation. La relation mathématique va prendre la forme suivante:</p>
<p><code class="docutils literal notranslate"><span class="pre">densite_matiere_grise</span> <span class="pre">=</span> <span class="pre">b0</span> <span class="pre">+</span> <span class="pre">b1</span> <span class="pre">*</span> <span class="pre">age</span> <span class="pre">+</span> <span class="pre">e</span></code></p>
<p>Où</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">densite_matiere_grise</span></code> est la densité de matière grise mesurée pour un voxel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">age</span></code> est l’âge du participant de recherche</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">b0</span></code> est une valeur constante, appelée en anglais “intercept” (l’ordonnée à l’origine). Cette valeur est identique pour tous les sujets. Dans ce cas-ci, elle représenterait la densité de matière grise observée à la naissance (<code class="docutils literal notranslate"><span class="pre">age=0</span></code>), en moyenne sur la population.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">b1</span></code> est une autre constante qui dans cet exemple mesure la réduction de matière grise par année de vie (en moyenne sur la population).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">e</span></code> est un bruit de mesure qui capture toutes les variations de <code class="docutils literal notranslate"><span class="pre">densite_matiere_grise</span></code> que l’on ne peut pas expliquer avec <code class="docutils literal notranslate"><span class="pre">age</span></code>. Typiquement, on suppose que la moyenne de <code class="docutils literal notranslate"><span class="pre">e</span></code> dans la population est <code class="docutils literal notranslate"><span class="pre">0</span></code> et que la variance de <code class="docutils literal notranslate"><span class="pre">e</span></code> est identique pour tous les sujets, égale à <span class="math notranslate nohighlight">\(\sigma^2\)</span>.</p></li>
</ul>
<p>On ne connait évidemment pas les coefficients <code class="docutils literal notranslate"><span class="pre">b0</span></code> et <code class="docutils literal notranslate"><span class="pre">b1</span></code>. Il sera nécessaire d’utiliser une procédure statistique pour les <code class="docutils literal notranslate"><span class="pre">estimer</span></code>, c’est à dire deviner (au mieux) leurs valeurs à partir des données dont nous disposons. Par exemple, pour la région de couleur <code class="docutils literal notranslate"><span class="pre">olive</span></code> (graphe de droite dans <a class="reference internal" href="#regression-vbm-fig"><span class="std std-numref">Fig. 94</span></a>), on voit que l’on perd environ 25% de densité entre 20 ans et 90 ans (voir <a class="reference internal" href="#regression-vbm-fig"><span class="std std-numref">Fig. 94</span></a>). On perd donc environ 0.35% de densité de matière grise par an, soit <code class="docutils literal notranslate"><span class="pre">b1</span> <span class="pre">~</span> <span class="pre">-0.0035</span></code>. En utilisant cette valeur et en remarquant que la densité de matière grise est d’à peu près <code class="docutils literal notranslate"><span class="pre">0.85</span></code> à <code class="docutils literal notranslate"><span class="pre">20</span></code> ans, on en déduit que la densité à la naissance devrait être <code class="docutils literal notranslate"><span class="pre">b0=0.92</span></code>. En pratique, la procédure statistique va choisir les valeurs <code class="docutils literal notranslate"><span class="pre">b0</span></code> et <code class="docutils literal notranslate"><span class="pre">b1</span></code> pour minimiser l’amplitude des résidus de la régression:</p>
<p><code class="docutils literal notranslate"><span class="pre">residus</span> <span class="pre">=</span> <span class="pre">densite_matiere_grise</span> <span class="pre">-</span> <span class="pre">b0</span> <span class="pre">-</span> <span class="pre">b1</span> <span class="pre">*</span> <span class="pre">age</span></code></p>
<p>Une fois les coefficients <code class="docutils literal notranslate"><span class="pre">b0</span></code> et <code class="docutils literal notranslate"><span class="pre">b1</span></code> estimés, on peut tracer une droite qui représente les valeurs de densité de matière grise prédites à partir de l’âge des sujets (voir <a class="reference internal" href="#regression-vbm-fig"><span class="std std-numref">Fig. 94</span></a>). Si le modèle permet d’expliquer une partie importante de la variabilité de la variable dépendante, les points mesurés seront proches de la droite de prédiction.</p>
</div>
<div class="section" id="analyse-massivement-univariee">
<h3>Analyse massivement univariée<a class="headerlink" href="#analyse-massivement-univariee" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn.glm.second_level</span> <span class="kn">import</span> <span class="n">make_second_level_design_matrix</span>
<span class="n">design_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;subject_label&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;femelle&#39;</span><span class="p">,</span> <span class="s1">&#39;male&#39;</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">design_matrix</span> <span class="o">=</span> <span class="n">make_second_level_design_matrix</span><span class="p">(</span>
    <span class="n">subject_label</span><span class="p">,</span>
    <span class="n">design_df</span>
    <span class="p">)</span>
<span class="kn">from</span> <span class="nn">nilearn.glm.second_level</span> <span class="kn">import</span> <span class="n">SecondLevelModel</span>
<span class="n">second_level_model</span> <span class="o">=</span> <span class="n">SecondLevelModel</span><span class="p">(</span><span class="n">smoothing_fwhm</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">second_level_model</span> <span class="o">=</span> <span class="n">second_level_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">gray_matter_map_filenames</span><span class="p">,</span>
                                            <span class="n">design_matrix</span><span class="o">=</span><span class="n">design_matrix</span><span class="p">)</span>
<span class="n">beta0</span> <span class="o">=</span> <span class="n">second_level_model</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="n">second_level_contrast</span><span class="o">=</span><span class="s2">&quot;intercept&quot;</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;effect_size&quot;</span><span class="p">)</span>
<span class="n">beta1</span> <span class="o">=</span> <span class="n">second_level_model</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="n">second_level_contrast</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;effect_size&quot;</span><span class="p">)</span>

<span class="c1"># On génère la Figure</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">beta0</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;intercept (b0)&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">beta1</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;effet de l</span><span class="se">\&#39;</span><span class="s1">age (b1)&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># On colle la figure dans le jupyter book</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;b0-b1-fig&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>           
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="b0-b1-fig" style="width: 600px">
<div class="cell_output docutils container">
<img alt="_images/cartes_statistiques_5_0.png" src="_images/cartes_statistiques_5_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 95 </span><span class="caption-text">Cartes de paramètres statistiques dans une régression linéaire massivement univariée. Première ligne: intercept <code class="docutils literal notranslate"><span class="pre">b0</span></code>, deuxième ligne: effet linéaire de l’âge <code class="docutils literal notranslate"><span class="pre">b1</span></code>. Cette figure est adaptée d’un tutoriel de la librairie <a class="reference external" href="https://nilearn.github.io/auto_examples/05_glm_second_level/plot_oasis.html#sphx-glr-auto-examples-05-glm-second-level-plot-oasis-py">nilearn</a> (cliquer sur + pour voir le code). Cette figure est distribuée sous license <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#b0-b1-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Pour l’instant, nous avons utilisé un modèle de régression pour deux voxels seulement. Mais une carte VBM peut inclure des centaines de milliers de voxels. Les logiciels de neuroimagerie permettent d’effectuer systématiquement une régression linéaire pour l’ensemble des voxels, simultanément. Dans ce cas, on estime deux paramètres pour chaque voxel: <code class="docutils literal notranslate"><span class="pre">b0</span></code> (l’intercept) et <code class="docutils literal notranslate"><span class="pre">b1</span></code> (l’effet de l’âge). On va donc générer deux cartes statistiques séparées (voir <a class="reference internal" href="#b0-b1-fig"><span class="std std-numref">Fig. 95</span></a>). Ces deux cartes récapitulent donc des milliers de modèles de régression différents. Comme les régressions effectuées à chaque voxel sont indépendantes les unes des autres, on parle de modèle univarié. L’autre option, le modèle multivarié, chercherait plutôt à combiner les valeurs obtenues à différents voxels. De plus, comme on fait un très grand nombre de régressions en même temps, on parle de régression <strong>massivement univariée</strong>.</p>
<div class="tip admonition" id="stats-multimodales">
<p class="admonition-title">Statistiques et multimodalité</p>
<p>Le modèle de régression est appliqué à plusieurs modalités de neuroimagerie. Dans ce chapitre, il est question d’un exemple utilisant la VBM. Mais le même modèle fonctionne dès lors qu’on a une série de cartes pour différents sujets. Il pourrait par exemple être utilisé en <a class="reference external" href="https://nilearn.github.io/auto_examples/05_glm_second_level/plot_second_level_one_sample_test.html#sphx-glr-auto-examples-05-glm-second-level-plot-second-level-one-sample-test-py">IRMf</a> ou bien en TEP. Le même type de modèle peut aussi s’appliquer à des mesures prises sur des récepteurs en imagerie optique ou des mesures moyennes sur un faisceau de fibres en IRMd. Le modèle de régression est partout!</p>
</div>
</div>
</div>
<div class="section" id="modele-lineaire-general">
<h2>Modèle linéaire général<a class="headerlink" href="#modele-lineaire-general" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Variables<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;ticks&quot;</span><span class="p">)</span>

<span class="c1"># Show the joint distribution using kernel density estimation</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;MG1&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;sexe&quot;</span><span class="p">,</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;scatter&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># On colle la figure dans le jupyter book</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;age-sexe-fig&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>           
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="age-sexe-fig" style="width: 600px">
<div class="cell_output docutils container">
<img alt="_images/cartes_statistiques_7_0.png" src="_images/cartes_statistiques_7_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 96 </span><span class="caption-text">Relation entre âge, sexe et densité de matière grise pour un voxel (le voxel de couleur bleu dans <a class="reference internal" href="#vbm-distribution-fig"><span class="std std-numref">Fig. 93</span></a>). Le graphique est réalisé à l’aide de la libraire <a class="reference external" href="https://seaborn.pydata.org">seaborn</a> (cliquer sur + pour voir le code). Cette figure est distribuée sous license <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#age-sexe-fig" title="Permalink to this image">¶</a></p>
</div>
<p>L’approche de régression linéaire que l’on vient de voir est simple et puissante, mais elle est limitée à deux variables. En neurosciences humaines, on ne se trouvera généralement pas dans ce cas. On va très souvent vouloir étudier des facteurs multiples de manière conjointe. Même si la représentation du sexe des participants par une variable binaire est <a class="reference external" href="https://blogs.scientificamerican.com/sa-visual/visualizing-sex-as-a-spectrum/">très (très) simplificatrice</a> - sans compter la diversité de l’identité de genre - nous allons quand même essayer d’intégrer le sexe (mâle vs femelle) dans notre analyse. La figure ci-dessus montre les distributions d’âge et de matière grise (pour le voxel bleu), séparées par sexe. Ce graphique suggère que la distribution de matière grise est peut-être différente entre male et femelle, mais cette différence pourrait également être liée à l’âge. Le modèle linéaire général nous permet d’intégrer toutes ces variables dans une seule analyse.</p>
</div>
<div class="section" id="regression-multiple">
<h3>Régression multiple<a class="headerlink" href="#regression-multiple" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn.plotting</span> <span class="kn">import</span> <span class="n">plot_design_matrix</span>
<span class="n">design_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;subject_label&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;sexe&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;femelle&#39;</span><span class="p">,</span> <span class="s1">&#39;male&#39;</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">design_matrix</span> <span class="o">=</span> <span class="n">make_second_level_design_matrix</span><span class="p">(</span>
    <span class="n">subject_label</span><span class="p">,</span>
    <span class="n">design_df</span>
    <span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;MG1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">design_matrix</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# sujet&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;MG&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Âge&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sexe&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Intercept&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plot_design_matrix</span><span class="p">(</span><span class="n">design_matrix</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Matrice de dessein&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# sujet&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># On colle la figure dans le jupyter book</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;design-matrix-fig&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>           
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="design-matrix-fig" style="width: 600px">
<div class="cell_output docutils container">
<img alt="_images/cartes_statistiques_9_0.png" src="_images/cartes_statistiques_9_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 97 </span><span class="caption-text">Variables pour une régression multiple. La variable dépendante est la densité de matière grise pour un voxel (MG, le voxel de couleur bleu dans <a class="reference internal" href="#vbm-distribution-fig"><span class="std std-numref">Fig. 93</span></a>). Les autres colonnes représentent les variations de l’âge, du sexe et de l’intercept à travers les sujets (variables prédictives). Les variables prédictives sont généralement représentées de manière plus compacte, sous la forme d’une image où la couleur de chaque pixel représente l’intensité du régresseur. Le graphique est adapté d’un <a class="reference external" href="https://dartbrains.org/content/GLM.html">code python</a> produit par l’équipe Dartbrains, ainsi que d’un <a class="reference external" href="https://nilearn.github.io/glm/first_level_model.html">tutoriel nilearn</a> (cliquer sur + pour voir le code). Cette figure est distribuée sous license <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#design-matrix-fig" title="Permalink to this image">¶</a></p>
</div>
<p>D’un point de vue mathématique, le modèle de régression multiple, parfois appelé modèle linéaire général, consiste simplement à incorporer plus de variables dans la “loi” qui tente de prédir la variable dépendante à partir des régresseurs:
<code class="docutils literal notranslate"><span class="pre">densite_matiere_grise</span> <span class="pre">=</span> <span class="pre">b0</span> <span class="pre">+</span> <span class="pre">b1</span> <span class="pre">*</span> <span class="pre">age</span> <span class="pre">+</span> <span class="pre">b2</span> <span class="pre">*</span> <span class="pre">sexe</span> <span class="pre">+</span> <span class="pre">e</span></code></p>
<p>Le seul nouveau coefficient est <code class="docutils literal notranslate"><span class="pre">b2</span></code>, qui dans ce cas mesure la différence entre la moyenne de matière grise entre les femelles (codées avec un 0 dans le modèle) et les mâles (codés avec un 1 dans le modèle), <strong>après un ajustement pour l’âge des sujets</strong>. Ce type de codage est utilisé avec les données catégorielles et est appelé “dummy variable” en anglais. Il permet d’intégrer des tests de différence de moyenne entre les groupes dans un modèle de régression.</p>
<div class="tip admonition" id="stats-regression">
<p class="admonition-title">Régression multiple et statistiques classiques</p>
<p>Le modèle de régression multiple est très flexible. Il est possible de formuler la plupart des tests statistiques classiques tels que l’analyse de variance (ANOVA) ou bien le test d’égalité des moyennes de Student (t-test) à l’aide du modèle de régression linéaire. Voir ce <a class="reference external" href="https://lindeloev.github.io/tests-as-linear/">guide</a> pour plus de détails.</p>
</div>
</div>
<div class="section" id="id2">
<h3>Cartes statistiques<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">second_level_model</span> <span class="o">=</span> <span class="n">SecondLevelModel</span><span class="p">(</span><span class="n">smoothing_fwhm</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">second_level_model</span> <span class="o">=</span> <span class="n">second_level_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">gray_matter_map_filenames</span><span class="p">,</span>
                                            <span class="n">design_matrix</span><span class="o">=</span><span class="n">design_matrix</span><span class="p">)</span>
<span class="n">beta0</span> <span class="o">=</span> <span class="n">second_level_model</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="n">second_level_contrast</span><span class="o">=</span><span class="s2">&quot;intercept&quot;</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;effect_size&quot;</span><span class="p">)</span>
<span class="n">beta1</span> <span class="o">=</span> <span class="n">second_level_model</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="n">second_level_contrast</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;effect_size&quot;</span><span class="p">)</span>
<span class="n">beta2</span> <span class="o">=</span> <span class="n">second_level_model</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="n">second_level_contrast</span><span class="o">=</span><span class="s2">&quot;sexe&quot;</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;effect_size&quot;</span><span class="p">)</span>

<span class="c1"># On génère la Figure</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">beta0</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;intercept (b0)&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">beta1</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;effet de l</span><span class="se">\&#39;</span><span class="s1">age (b1)&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">beta2</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;effet du sexe (b2)&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># On colle la figure dans le jupyter book</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;multi-regression-fig&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>           
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="multi-regression-fig" style="width: 800px">
<div class="cell_output docutils container">
<img alt="_images/cartes_statistiques_11_0.png" src="_images/cartes_statistiques_11_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 98 </span><span class="caption-text">Cartes de paramètres statistiques dans une régression linéaire multiple massivement univariée. Haut gauche: intercept <code class="docutils literal notranslate"><span class="pre">b0</span></code>, haut droite: effet linéaire de l’âge <code class="docutils literal notranslate"><span class="pre">b1</span></code>, bas gauche: effet linéaire du sexe <code class="docutils literal notranslate"><span class="pre">b2</span></code>. Cette figure est adaptée d’un tutoriel de la librairie <a class="reference external" href="https://nilearn.github.io/auto_examples/05_glm_second_level/plot_oasis.html#sphx-glr-auto-examples-05-glm-second-level-plot-oasis-py">nilearn</a> (cliquer sur + pour voir le code). Cette figure est distribuée sous license <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#multi-regression-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Une caractéristique qui peut être légèrement contre-intuitive avec la régression multiple est que la carte présentant l’effet de l’âge ici est différente de celle présentée dans la section portant sur la régression simple. En effet, l’effet de l’âge est maintenant évalué <em>après avoir pris en compte des différences de sexe</em>. Malgré cela, le résultat de la régression n’a pas changé de manière frappante: le cortex s’atrophie avec l’âge (en bleu), alors que le liquide céphalo-rachidien s’étend (en rouge). Ce qui apparait comme une expansion de la matière grise reflète probablement des effets de volume partiel et des tissus classifiés incorrectement comme de la matière grise. L’analyse sur la variable <code class="docutils literal notranslate"><span class="pre">sexe</span></code> montre que la densité de matière grise est plus élevée (en moyenne) dans le cortex chez les hommes, alors que la tendance est inversée au niveau du cervelet.</p>
</div>
</div>
<div class="section" id="tests-statistiques">
<h2>Tests statistiques<a class="headerlink" href="#tests-statistiques" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tests-t-et-valeur-p">
<h3>Tests t et valeur p<a class="headerlink" href="#tests-t-et-valeur-p" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn.image</span> <span class="kn">import</span> <span class="n">math_img</span>
<span class="n">z_score</span> <span class="o">=</span> <span class="n">second_level_model</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="n">second_level_contrast</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;z_score&quot;</span><span class="p">)</span>
<span class="n">p_value</span> <span class="o">=</span> <span class="n">second_level_model</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="n">second_level_contrast</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;p_value&quot;</span><span class="p">)</span>
<span class="n">neg_log_pval</span> <span class="o">=</span> <span class="n">math_img</span><span class="p">(</span><span class="s2">&quot;-np.log10(np.minimum(1, img))&quot;</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="n">p_value</span><span class="p">)</span>

<span class="c1"># On génère la Figure</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">z_score</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;t-test (âge)&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">neg_log_pval</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;significativité (-log10(p))&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># On colle la figure dans le jupyter book</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;tmap-pval-fig&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>           
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="tmap-pval-fig" style="width: 800px">
<div class="cell_output docutils container">
<img alt="_images/cartes_statistiques_13_0.png" src="_images/cartes_statistiques_13_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 99 </span><span class="caption-text">Tests statistiques sur la significativité de l’association entre densité de matière grise et âge. Test t de Student (haut) et log10(p) (bas). Cette figure est adaptée d’un tutoriel de la librairie <a class="reference external" href="https://nilearn.github.io/auto_examples/05_glm_second_level/plot_second_level_one_sample_test.html#sphx-glr-auto-examples-05-glm-second-level-plot-second-level-one-sample-test-py">nilearn</a> (cliquer sur + pour voir le code). Cette figure est distribuée sous license <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#tmap-pval-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Une fois que l’on a estimé l’effet de certaines variables explicatives (par exemple, l’âge) sur notre variable dépendante (par exemple, la densité de matière grise), il est nécessaire de tester la <strong>significativité</strong> de cet effet. À cette fin, on utilise l’amplitude des résidus pour estimer la taille d’effet que l’on pourrait observer par chance, si uniquement ces résidus étaient présents. On en déduit un test <code class="docutils literal notranslate"><span class="pre">t</span></code> de Student, qui se comporte comme une <a class="reference external" href="https://fr.wikipedia.org/wiki/Loi_normale">loi normale</a> quand le nombre de sujets est grand. Pour chaque voxel, on a donc une statistique <code class="docutils literal notranslate"><span class="pre">t</span></code> différente, et on peut calculer la probabilité <code class="docutils literal notranslate"><span class="pre">p</span></code> d’observer cette statistique sous l’<strong>hypothèse nulle</strong>, où l’effet de la variable explicative est exactement zéro.</p>
</div>
<div class="section" id="hypothese-nulle">
<h3>Hypothèse nulle<a class="headerlink" href="#hypothese-nulle" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">seed</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="c1"># seed random number generator</span>
<span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">design_rand_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;subject_label&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;femelle&#39;</span><span class="p">,</span> <span class="s1">&#39;male&#39;</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">design_rand_matrix</span> <span class="o">=</span> <span class="n">make_second_level_design_matrix</span><span class="p">(</span>
    <span class="n">subject_label</span><span class="p">,</span>
    <span class="n">design_df</span>
    <span class="p">)</span>
<span class="n">shuffle</span><span class="p">(</span><span class="n">design_rand_matrix</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>

<span class="n">second_level_model_rand</span> <span class="o">=</span> <span class="n">SecondLevelModel</span><span class="p">(</span><span class="n">smoothing_fwhm</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">second_level_model_rand</span> <span class="o">=</span> <span class="n">second_level_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">gray_matter_map_filenames</span><span class="p">,</span>
                                            <span class="n">design_matrix</span><span class="o">=</span><span class="n">design_rand_matrix</span><span class="p">)</span>

<span class="n">z_score_rand</span> <span class="o">=</span> <span class="n">second_level_model_rand</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="n">second_level_contrast</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;z_score&quot;</span><span class="p">)</span>
<span class="n">p_value_rand</span> <span class="o">=</span> <span class="n">second_level_model_rand</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="n">second_level_contrast</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;p_value&quot;</span><span class="p">)</span>
<span class="n">neg_log_pval_rand</span> <span class="o">=</span> <span class="n">math_img</span><span class="p">(</span><span class="s2">&quot;-np.log10(np.minimum(1, img))&quot;</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="n">p_value_rand</span><span class="p">)</span>

<span class="c1"># On génère la Figure</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">z_score_rand</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;t-test (H0)&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">neg_log_pval_rand</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;significativité H0 (-log10(p))&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># On colle la figure dans le jupyter book</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;null-fig&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>           
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="null-fig" style="width: 800px">
<div class="cell_output docutils container">
<img alt="_images/cartes_statistiques_15_0.png" src="_images/cartes_statistiques_15_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 100 </span><span class="caption-text">Tests statistiques sur la significativité de l’association entre densité de matière grise et âge, sous l’hypothèse nulle où il n’existe aucune association. Les données d’âge ont été permutées aléatoirement entre les sujets. Test t de Student (haut) et log10(p) (bas). Cette figure est adaptée d’un tutoriel de la librairie <a class="reference external" href="https://nilearn.github.io/auto_examples/05_glm_second_level/plot_second_level_one_sample_test.html#sphx-glr-auto-examples-05-glm-second-level-plot-second-level-one-sample-test-py">nilearn</a> (cliquer sur + pour voir le code). Cette figure est distribuée sous license <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#null-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Au coeur de l’interprétation de la valeur <code class="docutils literal notranslate"><span class="pre">p</span></code>, il y a ce qu’on appelle l’<strong>hypothèse nulle</strong>. Pour essayer de comprendre ce que cela veut dire, faisons une expérience. Nous allons recommencer toute la procédure d’estimation de l’effet de l’âge sur la densité de matière grise. Mais cette fois ci, au lieu d’utiliser l’âge réel des sujets, nous allons mélanger ces valeurs aléatoirement (on parle de <a class="reference external" href="https://fr.wikipedia.org/wiki/Permutation">permutations</a>). La distribution des tests <code class="docutils literal notranslate"><span class="pre">t</span></code> et des valeurs <code class="docutils literal notranslate"><span class="pre">p</span></code> est présentée dans la <a class="reference internal" href="#null-fig"><span class="std std-numref">Fig. 100</span></a>. De manière frappante, les valeurs <code class="docutils literal notranslate"><span class="pre">t</span></code> sont beaucoup plus petites avec les valeurs d’âge aléatoires que lorsqu’on a fait l’analyse avec les vraies valeurs, mais certaines valeurs restent élevées. On a réalisé une expérience sous l’hypothèse nulle, où il n’existe aucune association avec l’âge. La valeur <code class="docutils literal notranslate"><span class="pre">p</span></code> nous indique la <strong>fréquence</strong> avec laquelle on trouvera des valeurs d’effet de l’âge plus élevées sous l’hypothèse nulle que dans l’échantillon original. Pour estimer cela directement, il faudrait recommencer l’expérience que l’on vient de faire avec des milliers de permutations! Mais il existe aussi des méthodes approximées plus rapide.</p>
</div>
<div class="section" id="comparaisons-multiples">
<h3>Comparaisons multiples<a class="headerlink" href="#comparaisons-multiples" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn.glm</span> <span class="kn">import</span> <span class="n">threshold_stats_img</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="n">p_val</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">p001_uncorrected</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="n">p_val</span><span class="p">)</span>
<span class="n">p_val</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">p05_uncorrected</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="n">p_val</span><span class="p">)</span>

<span class="c1"># On génère la Figure</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">z_score</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">p05_uncorrected</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;t-test, p&lt;0.05&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">z_score</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">p001_uncorrected</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;t-test, p&lt;0.001&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">thresholded_map</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold_stats_img</span><span class="p">(</span>
    <span class="n">z_score</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span> <span class="n">height_control</span><span class="o">=</span><span class="s1">&#39;bonferroni&#39;</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">z_score</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;t-test, p&lt;0.05 corrigé&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">z_score_rand</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">p05_uncorrected</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;t-test (H0), p&lt;0.05&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">z_score_rand</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">p001_uncorrected</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;t-test (H0), p&lt;0.001&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">thresholded_map_rand</span><span class="p">,</span> <span class="n">threshold_rand</span> <span class="o">=</span> <span class="n">threshold_stats_img</span><span class="p">(</span>
    <span class="n">z_score_rand</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span> <span class="n">height_control</span><span class="o">=</span><span class="s1">&#39;bonferroni&#39;</span><span class="p">)</span>
<span class="n">roi_img</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">z_score_rand</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold_rand</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">gray_matter_map_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;t-test (H0), p&lt;0.05 corrigé&#39;</span><span class="p">)</span>
<span class="n">roi_img</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># On colle la figure dans le jupyter book</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;threshold-fig&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>           
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="threshold-fig" style="width: 800px">
<div class="cell_output docutils container">
<img alt="_images/cartes_statistiques_17_1.png" src="_images/cartes_statistiques_17_1.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 101 </span><span class="caption-text">Effet de différentes stratégies de seuillage sur l’association entre l’âge et la densité de matière grise. À gauche: données sous l’hypothèse nulle (valeurs d’âge permutée au travers des sujets). À droite: données originales. Ligne 1: seuil <code class="docutils literal notranslate"><span class="pre">p&lt;0.05</span></code> non corrigé pour les comparaisons multiples; ligne 2: seuil <code class="docutils literal notranslate"><span class="pre">p&lt;0.001</span></code> non corrigé pour les comparaisons multiples; seuil <code class="docutils literal notranslate"><span class="pre">p&lt;0.05</span></code> corrigé pour les comparaisons multiples par l’approche de Bonferroni. Cette figure est adaptée d’un tutoriel de la librairie <a class="reference external" href="https://nilearn.github.io/auto_examples/05_glm_second_level/plot_thresholding.html#sphx-glr-auto-examples-05-glm-second-level-plot-thresholding-py">nilearn</a> (cliquer sur + pour voir le code). Cette figure est distribuée sous license <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>.</span><a class="headerlink" href="#threshold-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Maintenant que l’on a discuté de l’interprétation de la valeur <code class="docutils literal notranslate"><span class="pre">p</span></code>, on doit maintenant décider d’un seuil à appliquer sur les valeurs <code class="docutils literal notranslate"><span class="pre">p</span></code>. Si l’on utilise le seuil habituel <code class="docutils literal notranslate"><span class="pre">p&lt;0.05</span></code>, cela signifie que pour 20 permutations, on détectera une association 1 fois (en moyenne) pour un voxel donné. Mais comme on a des milliers de voxels dans le cerveau, cela veut dire que l’on va détecter 5% du cerveau (en moyenne) pour chaque permutation! C’est ce que l’on observe (et même plus) dans la figure en haut à gauche <a class="reference internal" href="#threshold-fig"><span class="std std-numref">Fig. 101</span></a>. Il s’agit du <strong>problème de comparaisons multiples</strong>, et plus on fait de tests, plus ce problème est important.</p>
<p>Si l’on abaisse le seuil à <code class="docutils literal notranslate"><span class="pre">p&lt;0.001</span></code>, on ne détecte plus que 0.1% du cerveau (en moyenne) sous l’hypothèse nulle, et on observe en effet une réduction du nombre de voxels dans la figure de gauche, 2ième ligne <a class="reference internal" href="#threshold-fig"><span class="std std-numref">Fig. 101</span></a>.</p>
<p>La méthode la plus simple pour corriger du problème de comparaisons multiples est d’utiliser un seuil corrigé <code class="docutils literal notranslate"><span class="pre">p&lt;0.05/N</span></code>, où N est le nombre de comparaisons (c’est à dire de tests). Dans notre cas, on a approximativement 100,000 voxels, donc on va utiliser <code class="docutils literal notranslate"><span class="pre">p&lt;0.0000001</span></code>! Avec cette stratégie, aucun voxel ne passe le seuil dans notre expérience sous l’hypothèse nulle, voir figure en bas à gauche <a class="reference internal" href="#threshold-fig"><span class="std std-numref">Fig. 101</span></a>. En général c’est ce qui se passera (en moyenne) 19/20 permutations.</p>
<p>Si l’on observe maintenant l’effet de ces différentes stratégies sur les données originales, on observe que plus le seuil <code class="docutils literal notranslate"><span class="pre">p</span></code> est petit, moins on détecte d’effets significatifs. Malgré tout, même avec <code class="docutils literal notranslate"><span class="pre">p&lt;0.05</span></code> corrigé par l’approche de Bonferroni, on détecte toujours les effets principaux de l’âge.</p>
<div class="tip admonition" id="resolution-power">
<p class="admonition-title">Compromis résolution / puissance</p>
<p>En règle général, on doit faire un compromis entre la résolution (notre capacité à détecter des effets dans de petites régions du cerveau) et la puissance statistique (notre capacité à détecter des effets de petite taille). Si l’on veut une excellente résolution, on fait des tests à tous les voxels, mais on doit corriger pour un très grand nombre de comparaisons multiples. En revanche, si l’on ne teste qu’une valeur moyenne sur une région, on n’a qu’un seul test et aucune correction à appliquer, mais on ne sait pas ce qui se passe dans le reste du cerveau, ou à l’intérieur de cette région.</p>
</div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Le modèle de régression simple permet de prédire les observations d’une variable dépendante à partir d’une varible explicative.</p></li>
<li><p>Ce modèle est appliqué indépendamment à chaque voxel (approche massivement multivariée).</p></li>
<li><p>Il est possible d’utiliser le modèle linéaire général pour tester simultanément l’effet de plusieurs variables explicatives sur la variable dépendante.</p></li>
<li><p>Quand on effectue un grand nombre de tests statistiques à chaque voxel, il faut modifier le seuil de significativité du test (problème de comparaisons multiples).</p></li>
</ul>
</div>
<div class="section" id="exercices">
<h2>Exercices<a class="headerlink" href="#exercices" title="Permalink to this headline">¶</a></h2>
<div class="note admonition">
<p class="admonition-title">Exercice 9.1</p>
<p>On souhaite comparer la connectivité entre deux groupes de sujets, jeunes vs âgés.
Décrivez les variables prédictives à inclure dans un modèle de régression.<br />
Quelles autres variables vous semblent-elles importantes à inclure dans le modèle?</p>
</div>
<div class="note admonition">
<p class="admonition-title">Exercice 9.2</p>
<p>Vrai/faux (expliquez pourquoi)
Le modèle de régression peut être utilisé pour effectuer des statistiques de groupe pour les types de mesures suivantes… (vrai/faux)</p>
<ul class="simple">
<li><p>IRMf</p></li>
<li><p>IRM T1 (VBM)</p></li>
<li><p>IRM T1 (volumétrie)</p></li>
<li><p>IRM T1 (épaisseur corticale)</p></li>
<li><p>Données comportementales</p></li>
<li><p>Tomographie par émission de positrons</p></li>
<li><p>Imagerie optique</p></li>
<li><p>Imagerie de diffusion</p></li>
</ul>
</div>
<div class="note admonition">
<p class="admonition-title">Exercice 9.3</p>
<p>Vrai/faux. On observe une différence de moyenne entre deux groupes, et l’on effectue un test statistique qui nous donne une valeur p.</p>
<ul class="simple">
<li><p>La valeur p est la probabilité qu’il n’y ait pas de vraie différence.</p></li>
<li><p>Une faible valeur p indique une forte probabilité qu’il y ait une vraie différence.</p></li>
<li><p>La valeur p indique la probabilité d’observer cette différence, au moins, s’il n’existait vraiment aucune différence entre les deux groupes.</p></li>
</ul>
</div>
<div class="note admonition">
<p class="admonition-title">Exercice 9.4</p>
<p>Vrai/faux. Un problème de comparaisons multiples signifie.</p>
<ul class="simple">
<li><p>Qu’on effectue de manière répétée des test statistiques générant une valeur p.</p></li>
<li><p>Que l’on répète un test statistique à chaque voxel dans une image du cerveau, par exemple.</p></li>
<li><p>Que l’on teste beaucoup d’hypothèses dans un article, par exemple.</p></li>
<li><p>Que l’on a quatre sous-groupes, et que l’on compare chacune des trois paires possibles de sous-groupes, par exemple.</p></li>
</ul>
</div>
<div class="note admonition">
<p class="admonition-title">Exercice 9.5</p>
<p>Classer les analyses suivantes du plus petit au plus grand, en fonction du nombre de comparaisons multiples impliquées. Indiquez le nombre approximatif de comparaisons.
On compare la densité de matière grise entre deux groupes de sujets à chaque voxel du cerveau.
On compare le métabolisme du glucose entre deux groupes de sujets à chaque voxel du cerveau, à l’aide du FDG-TEP.
On compare le volume de régions cérébrales entre deux groupes de sujets, à partir d’un atlas qui comprend 90 régions.
On compare le volume de l’hippocampe entre deux groupes de sujets.</p>
</div>
<div class="note admonition">
<p class="admonition-title">Exercice 9.6</p>
<p>Pour répondre aux questions de cet exercice, lisez d’abord l’article <em>Tau pathology in cognitively normal older adults</em> de Ziontz et collaborateurs (disponible comme <a class="reference external" href="https://doi.org/10.1101/611186">preprint</a> sur Biorxiv sous licence CC0 et publié dans le journal Alzheimer’s &amp; Dementia: Diagnosis, Assessment &amp; Disease Monitoring <a class="reference external" href="https://doi.org/10.1016/j.dadm.2019.07.007">doi</a>. Les questions suivantes requièrent des réponses à développement court.
Pour répondre aux questions de cet exercice, on s’intéresse à la section 2.5.1 de l’article <em>Tau pathology in cognitively normal older adults</em> de Ziontz et collaborateurs (disponible comme <a class="reference external" href="https://doi.org/10.1101/611186">preprint</a> sur Biorxiv sous licence CC0 et publié dans le journal Alzheimer’s &amp; Dementia: Diagnosis, Assessment &amp; Disease Monitoring <a class="reference external" href="https://doi.org/10.1016/j.dadm.2019.07.007">doi</a>. Les questions suivantes requièrent des réponses à développement court.</p>
<ul class="simple">
<li><p>Quelle est la variable dépendante du modèle linéaire?</p></li>
<li><p>Quelles variables explicatives sont incluses dans le modèle linéaire?</p></li>
<li><p>Sait on combien de comparaisons multiples sont faites?</p></li>
<li><p>Comment est ce que les comparaisons multiples sont corrigées?</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="imagerie_optique.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Imagerie optique</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="reproductibilite.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Reproductibilité et controverses</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Pierre Bellec et l'équipe PSY3018<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>