Traceback (most recent call last):
  File "/home/pbellec/.virtualenvs/psy3018/lib/python3.10/site-packages/jupyter_cache/executors/utils.py", line 51, in single_nb_execution
    executenb(
  File "/home/pbellec/.virtualenvs/psy3018/lib/python3.10/site-packages/nbclient/client.py", line 1204, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
  File "/home/pbellec/.virtualenvs/psy3018/lib/python3.10/site-packages/nbclient/util.py", line 84, in wrapped
    return just_run(coro(*args, **kwargs))
  File "/home/pbellec/.virtualenvs/psy3018/lib/python3.10/site-packages/nbclient/util.py", line 62, in just_run
    return loop.run_until_complete(coro)
  File "/usr/lib/python3.10/asyncio/base_events.py", line 646, in run_until_complete
    return future.result()
  File "/home/pbellec/.virtualenvs/psy3018/lib/python3.10/site-packages/nbclient/client.py", line 663, in async_execute
    await self.async_execute_cell(
  File "/home/pbellec/.virtualenvs/psy3018/lib/python3.10/site-packages/nbclient/client.py", line 965, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/home/pbellec/.virtualenvs/psy3018/lib/python3.10/site-packages/nbclient/client.py", line 862, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
from nilearn.plotting import plot_design_matrix
design_df = df[["subject_label", "age", "sexe"]].replace(['femelle', 'male'], value=[0., 1.])
design_matrix = make_second_level_design_matrix(
    subject_label,
    design_df
    )
fig, ax = plt.subplots(ncols=5, figsize=(6, 12), sharey=True)
Y = df["MG1"].to_numpy()
X = design_matrix.to_numpy()
ax[0].plot(np.expand_dims(Y, axis=1), range(len(Y)))
ax[1].plot(X[:,0], range(len(Y)))
ax[2].plot(X[:,1], range(len(Y)))
ax[3].plot(X[:,2], range(len(Y)))
ax[0].set_ylabel('# sujet', fontsize=18)
ax[0].set_title('MG', fontsize=20)
ax[1].set_title('Ã‚ge', fontsize=20)
ax[2].set_title('Sexe', fontsize=20)
ax[3].set_title('Intercept', fontsize=20)
plot_design_matrix(design_matrix, ax=ax[4])
ax[4].set_title('Matrice de dessein', fontsize=12)
ax[4].set_ylabel('# sujet')
plt.gca().invert_yaxis()
plt.tight_layout()

# On colle la figure dans le jupyter book
from myst_nb import glue
glue("design-matrix-fig", fig, display=False)           
------------------

[0;31m---------------------------------------------------------------------------[0m
[0;31mUFuncTypeError[0m                            Traceback (most recent call last)
Cell [0;32mIn [5], line 3[0m
[1;32m      1[0m [38;5;28;01mfrom[39;00m [38;5;21;01mnilearn[39;00m[38;5;21;01m.[39;00m[38;5;21;01mplotting[39;00m [38;5;28;01mimport[39;00m plot_design_matrix
[1;32m      2[0m design_df [38;5;241m=[39m df[[[38;5;124m"[39m[38;5;124msubject_label[39m[38;5;124m"[39m, [38;5;124m"[39m[38;5;124mage[39m[38;5;124m"[39m, [38;5;124m"[39m[38;5;124msexe[39m[38;5;124m"[39m]][38;5;241m.[39mreplace([[38;5;124m'[39m[38;5;124mfemelle[39m[38;5;124m'[39m, [38;5;124m'[39m[38;5;124mmale[39m[38;5;124m'[39m], value[38;5;241m=[39m[[38;5;241m0.[39m, [38;5;241m1.[39m])
[0;32m----> 3[0m design_matrix [38;5;241m=[39m [43mmake_second_level_design_matrix[49m[43m([49m
[1;32m      4[0m [43m    [49m[43msubject_label[49m[43m,[49m
[1;32m      5[0m [43m    [49m[43mdesign_df[49m
[1;32m      6[0m [43m    [49m[43m)[49m
[1;32m      7[0m fig, ax [38;5;241m=[39m plt[38;5;241m.[39msubplots(ncols[38;5;241m=[39m[38;5;241m5[39m, figsize[38;5;241m=[39m([38;5;241m6[39m, [38;5;241m12[39m), sharey[38;5;241m=[39m[38;5;28;01mTrue[39;00m)
[1;32m      8[0m Y [38;5;241m=[39m df[[38;5;124m"[39m[38;5;124mMG1[39m[38;5;124m"[39m][38;5;241m.[39mto_numpy()

File [0;32m~/.virtualenvs/psy3018/lib/python3.10/site-packages/nilearn/glm/first_level/design_matrix.py:475[0m, in [0;36mmake_second_level_design_matrix[0;34m(subjects_label, confounds)[0m
[1;32m    473[0m [38;5;66;03m# check design matrix is not singular[39;00m
[1;32m    474[0m sys[38;5;241m.[39mfloat_info[38;5;241m.[39mepsilon
[0;32m--> 475[0m [38;5;28;01mif[39;00m [43mnp[49m[38;5;241;43m.[39;49m[43mlinalg[49m[38;5;241;43m.[39;49m[43mcond[49m[43m([49m[43mdesign_matrix[49m[38;5;241;43m.[39;49m[43mvalues[49m[43m)[49m [38;5;241m>[39m design_matrix[38;5;241m.[39msize:
[1;32m    476[0m     warn([38;5;124m'[39m[38;5;124mAttention: Design matrix is singular. Aberrant estimates [39m[38;5;124m'[39m
[1;32m    477[0m          [38;5;124m'[39m[38;5;124mare expected.[39m[38;5;124m'[39m)
[1;32m    478[0m [38;5;28;01mreturn[39;00m design_matrix

File [0;32m<__array_function__ internals>:180[0m, in [0;36mcond[0;34m(*args, **kwargs)[0m

File [0;32m~/.virtualenvs/psy3018/lib/python3.10/site-packages/numpy/linalg/linalg.py:1762[0m, in [0;36mcond[0;34m(x, p)[0m
[1;32m   1760[0m     [38;5;28;01mraise[39;00m LinAlgError([38;5;124m"[39m[38;5;124mcond is not defined on empty arrays[39m[38;5;124m"[39m)
[1;32m   1761[0m [38;5;28;01mif[39;00m p [38;5;129;01mis[39;00m [38;5;28;01mNone[39;00m [38;5;129;01mor[39;00m p [38;5;241m==[39m [38;5;241m2[39m [38;5;129;01mor[39;00m p [38;5;241m==[39m [38;5;241m-[39m[38;5;241m2[39m:
[0;32m-> 1762[0m     s [38;5;241m=[39m [43msvd[49m[43m([49m[43mx[49m[43m,[49m[43m [49m[43mcompute_uv[49m[38;5;241;43m=[39;49m[38;5;28;43;01mFalse[39;49;00m[43m)[49m
[1;32m   1763[0m     [38;5;28;01mwith[39;00m errstate([38;5;28mall[39m[38;5;241m=[39m[38;5;124m'[39m[38;5;124mignore[39m[38;5;124m'[39m):
[1;32m   1764[0m         [38;5;28;01mif[39;00m p [38;5;241m==[39m [38;5;241m-[39m[38;5;241m2[39m:

File [0;32m<__array_function__ internals>:180[0m, in [0;36msvd[0;34m(*args, **kwargs)[0m

File [0;32m~/.virtualenvs/psy3018/lib/python3.10/site-packages/numpy/linalg/linalg.py:1669[0m, in [0;36msvd[0;34m(a, full_matrices, compute_uv, hermitian)[0m
[1;32m   1666[0m     gufunc [38;5;241m=[39m _umath_linalg[38;5;241m.[39msvd_n
[1;32m   1668[0m signature [38;5;241m=[39m [38;5;124m'[39m[38;5;124mD->d[39m[38;5;124m'[39m [38;5;28;01mif[39;00m isComplexType(t) [38;5;28;01melse[39;00m [38;5;124m'[39m[38;5;124md->d[39m[38;5;124m'[39m
[0;32m-> 1669[0m s [38;5;241m=[39m [43mgufunc[49m[43m([49m[43ma[49m[43m,[49m[43m [49m[43msignature[49m[38;5;241;43m=[39;49m[43msignature[49m[43m,[49m[43m [49m[43mextobj[49m[38;5;241;43m=[39;49m[43mextobj[49m[43m)[49m
[1;32m   1670[0m s [38;5;241m=[39m s[38;5;241m.[39mastype(_realType(result_t), copy[38;5;241m=[39m[38;5;28;01mFalse[39;00m)
[1;32m   1671[0m [38;5;28;01mreturn[39;00m s

[0;31mUFuncTypeError[0m: Cannot cast ufunc 'svd_n' input from dtype('O') to dtype('float64') with casting rule 'same_kind'
UFuncTypeError: Cannot cast ufunc 'svd_n' input from dtype('O') to dtype('float64') with casting rule 'same_kind'

